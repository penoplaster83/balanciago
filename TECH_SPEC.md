# Техническое Задание: Редактор Игровых Бонусов "Balanciago"

## 1. Введение

"Balanciago" - это веб-приложение, предназначенное для геймдизайнеров. Оно позволяет визуализировать, создавать и управлять системой игровых бонусов и их зависимостями.

## 2. Описание Системы

### 2.1. Сущность "Бонус"

- **Описание:** Бонусы предоставляют игроку различные способности или улучшают существующие.
- **Механика в игре:** Игроку предлагается на выбор 3 случайных бонуса из общего пула.
- **Зависимости:** Некоторые бонусы могут требовать наличия других бонусов у игрока для того, чтобы стать доступными.

### 2.2. Пользовательский Интерфейс

- **Область отображения:** Граф бонусов занимает основную часть экрана (~90% ширины, ~80-90% высоты окна просмотра).
- **Узел (Нод) Бонуса:**
  - **Визуализация:** Прямоугольный блок.
  - **Размеры:** Фиксированная ширина (например, 200px), высота автоматически подстраивается под содержимое.
  - **Содержимое узла:**
    - Название бонуса (жирным шрифтом).
    - Описание свойства бонуса.
  - **Интерактивность:** Узлы можно перетаскивать по холсту.
- **Связи между бонусами (Зависимости):**
  - **Направление:** Линия направлена (имеет стрелку на конце) от бонуса-требования к бонусу, который от него зависит.
  - **Визуализация:** Линии ортогональные, могут состоять из нескольких сегментов, под углами 90 градусов. Каждая линия старается оптимизироваться и иметь как можно меньше изгибов, но обязательно с учетом того, что она не пересекает другие ноды
  - **Точки подключения:** Линия выходит из центра одной из граней ноды-требования и входит в центр некоторой грани зависимого нода. Линии выбирают из какой грани выйти и в какую грань войти, так чтобы по итогу путь и кол-во изгибов были минимально возможными.
  - **Перекрытие:** Узлы всегда отображаются поверх линий связей. Линии могут пересекать друг друга.
- **Типы связей:**
  - Один бонус может зависеть от одного или нескольких других бонусов (включая 3 и более).
  - Один бонус может являться требованием для одного или нескольких других бонусов.
  - Некоторые бонусы могут не иметь зависимостей и/или не являться требованием для других.
- **Расположение узлов (Начальное и Пользовательское):**
  - **Начальное:** Предусмотрен набор бонусов с предопределенными координатами для демонстрации.
  - **Пользовательское:** Геймдизайнер может перетаскивать узлы для организации их по своему усмотрению.

## 3. Начальный Набор Бонусов (Пример)

Для демонстрации и тестирования используется набор из 17 бонусов (полный список и их связи определены в `src/stores/bonuses.ts`), включающий:

- Различные типы зависимостей (нет зависимостей, только входящие, только исходящие, смешанные).
- Бонусы с множественными входящими зависимостями (например, до 4-х).

_Пример структуры бонуса в коде:_

```typescript
interface Bonus {
  id: string // Уникальный идентификатор (например, 'strength-boost-1')
  name: string // Отображаемое имя
  description: string // Описание эффекта
  dependencies: string[] // Массив ID бонусов, от которых этот зависит
  unlocks: string[] // Массив ID бонусов, которые этот открывает (для удобства, не используется для рендеринга связей напрямую)
  x: number // Координата X на холсте
  y: number // Координата Y на холсте
}
```

## 4. Дальнейшие Планы и Возможные Улучшения

- **Интеллектуальное размещение узлов:**
  - Разработка алгоритма для автоматического "разумного" размещения узлов, минимизирующего пересечения и улучшающего читаемость.
  - Критерии: отсутствие наложений, видимость связей, логическое группирование (влияющие слева, зависимые правее по мере увеличения глубины зависимостей).
- **Обход препятствий линиями связей:**
  - Реализация алгоритма, позволяющего линиям связей огибать другие узлы, а не проходить сквозь них.
- **Скругленные углы у линий связей:** Использование SVG `path` с командами кривых Безье для более плавных изгибов линий.
- **Объединение параллельных сегментов линий (Edge Bundling):** Для случаев, когда несколько линий идут параллельно от одной группы узлов к другой, их начальные сегменты могут быть объединены для улучшения визуальной чистоты.
- **Реализация CRUD операций для бонусов** через интерфейс.
- **Возможность редактирования связей** между бонусами через интерфейс.
- **Сохранение и загрузка** конфигурации бонусов.
- **Масштабирование и панорамирование холста.**
- **Экспорт конфигурации** в формат, понятный игровому движку (например, JSON).

---

_Этот документ будет дополняться по мере развития проекта._
